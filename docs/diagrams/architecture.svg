<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1100 740" width="1100" height="740">
  <style>
    .title { font-family: Arial, sans-serif; font-size: 17px; font-weight: bold; }
    .label { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; }
    .small { font-family: Arial, sans-serif; font-size: 13px; }
    .tiny { font-family: Arial, sans-serif; font-size: 11px; }
    .arrow-label { font-family: Arial, sans-serif; font-size: 11px; fill: #495057; }
  </style>

  <!-- Background -->
  <rect width="1100" height="740" fill="#ffffff"/>

  <!-- Arrow marker -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#1e1e1e"/>
    </marker>
  </defs>

  <!-- ================================================================ -->
  <!-- USER INPUT                                                       -->
  <!-- ================================================================ -->
  <rect x="410" y="8" width="220" height="50" rx="8" fill="#ffc9c9" stroke="#e03131" stroke-width="2"/>
  <text x="520" y="38" text-anchor="middle" class="label" fill="#1e1e1e">User Input</text>

  <!-- ================================================================ -->
  <!-- AGENT LAYER CONTAINER                                            -->
  <!-- ================================================================ -->
  <rect x="30" y="78" width="1040" height="310" rx="8" fill="#e7f5ff" stroke="#1971c2" stroke-width="2"/>
  <text x="550" y="101" text-anchor="middle" class="title" fill="#1971c2">Agent Layer</text>

  <!-- Command Parser -->
  <rect x="55" y="118" width="185" height="78" rx="6" fill="#a5d8ff" stroke="#1971c2" stroke-width="2"/>
  <text x="147" y="146" text-anchor="middle" class="label" fill="#1e1e1e">Command Parser</text>
  <text x="147" y="164" text-anchor="middle" class="tiny" fill="#495057">accept · dismiss</text>
  <text x="147" y="179" text-anchor="middle" class="tiny" fill="#495057">clarify · tickets</text>

  <!-- Session State -->
  <rect x="265" y="118" width="200" height="78" rx="6" fill="#ffec99" stroke="#f08c00" stroke-width="2"/>
  <text x="365" y="146" text-anchor="middle" class="label" fill="#1e1e1e">Session State</text>
  <text x="365" y="164" text-anchor="middle" class="tiny" fill="#495057">requirements store</text>
  <text x="365" y="179" text-anchor="middle" class="tiny" fill="#495057">decisions · clarifications</text>

  <!-- Formatters -->
  <rect x="545" y="118" width="170" height="78" rx="6" fill="#d0bfff" stroke="#7048e8" stroke-width="2"/>
  <text x="630" y="146" text-anchor="middle" class="label" fill="#1e1e1e">Formatters</text>
  <text x="630" y="164" text-anchor="middle" class="tiny" fill="#495057">tables · trees</text>
  <text x="630" y="179" text-anchor="middle" class="tiny" fill="#495057">summaries</text>

  <!-- Terminal Output -->
  <rect x="755" y="118" width="170" height="78" rx="6" fill="#b2f2bb" stroke="#2f9e44" stroke-width="2"/>
  <text x="840" y="146" text-anchor="middle" class="label" fill="#1e1e1e">Terminal Output</text>
  <text x="840" y="164" text-anchor="middle" class="tiny" fill="#495057">formatted</text>
  <text x="840" y="179" text-anchor="middle" class="tiny" fill="#495057">display</text>

  <!-- Agent Loop -->
  <rect x="55" y="262" width="810" height="80" rx="6" fill="#a5d8ff" stroke="#1971c2" stroke-width="2"/>
  <text x="460" y="294" text-anchor="middle" class="label" fill="#1e1e1e">Agent Loop (OpenAI Agents SDK)</text>
  <text x="460" y="314" text-anchor="middle" class="tiny" fill="#495057">JSON extraction · conversation history · retry handling</text>

  <!-- ================================================================ -->
  <!-- ARROWS WITHIN AGENT LAYER                                        -->
  <!-- ================================================================ -->

  <!-- User Input → Command Parser ("commands") -->
  <line x1="415" y1="53" x2="210" y2="118" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="295" y="76" class="arrow-label">commands</text>

  <!-- User Input → Agent Loop ("natural language") through gap -->
  <line x1="520" y1="58" x2="500" y2="262" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="440" y="225" class="arrow-label">natural language</text>

  <!-- Command Parser → Session State -->
  <line x1="240" y1="157" x2="260" y2="157" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Formatters → Terminal Output -->
  <line x1="715" y1="157" x2="750" y2="157" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Agent Loop → Session State ("store") -->
  <line x1="250" y1="262" x2="350" y2="200" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="262" y="240" class="arrow-label">store</text>

  <!-- Agent Loop → Formatters ("format") -->
  <line x1="660" y1="262" x2="640" y2="200" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <text x="662" y="240" class="arrow-label">format</text>

  <!-- ================================================================ -->
  <!-- STDIO CONNECTION                                                 -->
  <!-- ================================================================ -->
  <line x1="460" y1="342" x2="460" y2="400" stroke="#1e1e1e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="478" y="378" class="small" fill="#495057">stdio</text>

  <!-- ================================================================ -->
  <!-- MCP SERVER CONTAINER                                             -->
  <!-- ================================================================ -->
  <rect x="30" y="410" width="1040" height="200" rx="8" fill="#d3f9d8" stroke="#2f9e44" stroke-width="2"/>
  <text x="550" y="433" text-anchor="middle" class="title" fill="#1e1e1e">MCP Server (prd_decomposer)</text>

  <!-- read_file tool -->
  <rect x="55" y="450" width="130" height="45" rx="6" fill="#dee2e6" stroke="#495057" stroke-width="2"/>
  <text x="120" y="478" text-anchor="middle" class="small" fill="#1e1e1e">read_file</text>

  <!-- analyze_prd tool -->
  <rect x="220" y="450" width="150" height="45" rx="6" fill="#d0bfff" stroke="#7048e8" stroke-width="2"/>
  <text x="295" y="478" text-anchor="middle" class="small" fill="#1e1e1e">analyze_prd</text>

  <!-- decompose_to_tickets tool -->
  <rect x="405" y="450" width="170" height="45" rx="6" fill="#d0bfff" stroke="#7048e8" stroke-width="2"/>
  <text x="490" y="470" text-anchor="middle" class="small" fill="#1e1e1e">decompose_</text>
  <text x="490" y="486" text-anchor="middle" class="small" fill="#1e1e1e">to_tickets</text>

  <!-- export_tickets tool -->
  <rect x="610" y="450" width="150" height="45" rx="6" fill="#dee2e6" stroke="#495057" stroke-width="2"/>
  <text x="685" y="478" text-anchor="middle" class="small" fill="#1e1e1e">export_tickets</text>

  <!-- health_check tool -->
  <rect x="800" y="450" width="130" height="45" rx="6" fill="#dee2e6" stroke="#495057" stroke-width="2"/>
  <text x="865" y="478" text-anchor="middle" class="small" fill="#1e1e1e">health_check</text>

  <!-- Arrows from tools to services -->
  <line x1="120" y1="495" x2="120" y2="540" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="295" y1="495" x2="295" y2="540" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="490" y1="495" x2="490" y2="540" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="685" y1="495" x2="685" y2="540" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>
  <line x1="865" y1="495" x2="865" y2="540" stroke="#1e1e1e" stroke-width="1.5" marker-end="url(#arrowhead)"/>

  <!-- Filesystem -->
  <rect x="55" y="550" width="130" height="40" rx="6" fill="#dee2e6" stroke="#495057" stroke-width="2"/>
  <text x="120" y="575" text-anchor="middle" class="small" fill="#1e1e1e">Filesystem</text>

  <!-- GPT-4o -->
  <rect x="230" y="550" width="310" height="40" rx="6" fill="#ffec99" stroke="#f08c00" stroke-width="2"/>
  <text x="385" y="575" text-anchor="middle" class="small" fill="#1e1e1e">GPT-4o (OpenAI)</text>

  <!-- CSV/Jira/YAML -->
  <rect x="590" y="550" width="180" height="40" rx="6" fill="#dee2e6" stroke="#495057" stroke-width="2"/>
  <text x="680" y="575" text-anchor="middle" class="small" fill="#1e1e1e">CSV / Jira / YAML</text>

  <!-- Status -->
  <rect x="810" y="550" width="110" height="40" rx="6" fill="#dee2e6" stroke="#495057" stroke-width="2"/>
  <text x="865" y="575" text-anchor="middle" class="small" fill="#1e1e1e">Status</text>

  <!-- ================================================================ -->
  <!-- DATA FLOW                                                        -->
  <!-- ================================================================ -->
  <text x="550" y="640" text-anchor="middle" class="title" fill="#1e1e1e">Data Flow</text>

  <!-- PRD Input -->
  <rect x="40" y="658" width="170" height="60" rx="6" fill="#ffc9c9" stroke="#e03131" stroke-width="2"/>
  <text x="125" y="684" text-anchor="middle" class="small" fill="#1e1e1e">PRD Input</text>
  <text x="125" y="702" text-anchor="middle" class="tiny" fill="#495057">(markdown)</text>

  <!-- StructuredRequirements -->
  <rect x="280" y="658" width="210" height="60" rx="6" fill="#a5d8ff" stroke="#1971c2" stroke-width="2"/>
  <text x="385" y="680" text-anchor="middle" class="small" fill="#1e1e1e">Structured</text>
  <text x="385" y="697" text-anchor="middle" class="small" fill="#1e1e1e">Requirements</text>
  <text x="385" y="713" text-anchor="middle" class="tiny" fill="#495057">(Pydantic)</text>

  <!-- TicketCollection -->
  <rect x="560" y="658" width="190" height="60" rx="6" fill="#b2f2bb" stroke="#2f9e44" stroke-width="2"/>
  <text x="655" y="684" text-anchor="middle" class="small" fill="#1e1e1e">TicketCollection</text>
  <text x="655" y="702" text-anchor="middle" class="tiny" fill="#495057">(Epics + Stories)</text>

  <!-- Export Formats -->
  <rect x="820" y="658" width="190" height="60" rx="6" fill="#dee2e6" stroke="#495057" stroke-width="2"/>
  <text x="915" y="684" text-anchor="middle" class="small" fill="#1e1e1e">Export Formats</text>
  <text x="915" y="702" text-anchor="middle" class="tiny" fill="#495057">(CSV / Jira / YAML)</text>

  <!-- Data flow arrows -->
  <line x1="210" y1="688" x2="270" y2="688" stroke="#1e1e1e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="490" y1="688" x2="550" y2="688" stroke="#1e1e1e" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="750" y1="688" x2="810" y2="688" stroke="#1e1e1e" stroke-width="2" marker-end="url(#arrowhead)"/>
</svg>
